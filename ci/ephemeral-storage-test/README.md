# エフェメラルストレージテスト環境

このプロジェクトは、OCIのコンテナインスタンスがエフェメラルストレージ（永続化されないストレージ）のみを持つことを確認するためのテスト環境です。

## 構成

- `app/`: Node.jsアプリケーション
  - シンプルなREST APIを提供
  - ノートの作成と取得が可能
- `db/`: MySQLデータベース
  - 永続化ボリュームを意図的に設定せず、エフェメラルストレージのみを使用

## 動作確認手順

### 1. 環境の起動

```bash
docker-compose up -d --build
```

MySQLの準備が完了するまで少し時間がかかります。アプリケーションは自動的にMySQLへの接続を試みます。

### 2. 初期データの確認

```bash
curl http://localhost:3000/notes
```

init.sqlで登録された2件のテストデータが表示されます。

### 3. 新しいデータの作成

```bash
curl -X POST -H "Content-Type: application/json" \
     -d '{"content":"This is a test note"}' \
     http://localhost:3000/notes
```

### 4. 作成したデータの確認

```bash
curl http://localhost:3000/notes
```

先ほど作成したデータが追加されていることを確認できます。

### 5. コンテナの停止と削除

```bash
docker-compose down
```

この操作により、コンテナ内のデータが完全に失われます。

### 6. 環境の再起動

```bash
docker-compose up -d
```

### 7. データの再確認

```bash
curl http://localhost:3000/notes
```

ここで重要な点を確認できます：
- 手順3で作成したデータは失われています
- init.sqlで初期登録した2件のデータのみが存在します

これは、コンテナが完全にエフェメラルストレージで動作しており、コンテナを停止すると全てのデータが失われることを示しています。



# tips
- ローカルで作成したイメージをOCIRにプッシュする際、OCIR側に指定のレポジトリがないと、ルートコンパートメントにレポジトリが自動作成される
  - 指定のレポジトリがある場合は、そのレポジトリにプッシュされる
  - そのため、指定のコンパートメントにイメージをプッシュしたい場合は、確実に指定のコンパートメントにレポジトリを事前に作成しておく必要がある
